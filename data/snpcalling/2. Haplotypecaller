Script by A.Talavera <3
We make a file contigs.txt with all the chromosomes from the indexed genome (in this case they were'nt chromosomes but contigs)
grep NC /home/goliath/DiscoC/aphanius/copy_data/reference_genome/assembly/AphaniusSeq_MaSuRCA-polished.fa.fai > contigs.txt

ref=/home/goliath/DiscoC/aphanius/copy_data/reference_genome/assembly/AphaniusSeq_MaSuRCA-polished.fa
chromosomes=/home/goliath/DiscoC/aphanius/copy_data/reference_genome/assembly/contigs.txt
samples=/home/goliath/DiscoC/aphanius/new_samples/samples.txt 
IN=/home/goliath/DiscoC/aphanius/new_samples


touch sample-chromosome2.txt
for sample in $(cat $samples); do
        (
        for chromo in $(cat $chromosomes); do 
                (       
                echo "$sample"-"$chromo" | tee -a sample-chromosome2.txt
                )
                done
        ) 
done

N=20

for i in $(cat sample-chromosome2.txt); do
        (
                echo "starting to call haplotypes from $i"
                library=`echo "$i" | cut -d - -f 1`
                chromosome=`echo "$i" | cut -d - -f 2-3`
        /home/goliath/software/gatk-4.1.3.0/gatk HaplotypeCaller --reference $ref --input "$IN""$library"_mkdp_30.bam -O "$library"_"$chromosome".g.vcf.gz>
        ) &
        #allow to execute up to $N jobs in parallel
        if [[ $(jobs -r -p | wc -l) -ge $N ]]; then
        wait -n
        fi
done
wait
rm sample2-chromosome2.txt
echo "All finished <3"
